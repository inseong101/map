<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì†Œì•„ê³¼í•™ ëª©ì°¨</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, -apple-system, "Noto Sans KR", Segoe UI, Roboto, Arial, sans-serif; margin:0; background:#fafbfc; }
    .topbar { position: sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid rgba(0,0,0,.08); padding:10px 16px; }
    .topbar a { text-decoration:none; color:#0a66c2; font-weight:700; }
    .wrap { max-width: 960px; margin: 32px auto; padding: 0 16px; }
    h1 { margin: 0 0 12px; font-size: 24px; }

    /* ì¥ ì¹´ë“œ */
    .chapter { background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:12px; margin-bottom:12px; overflow:hidden; }
    .chapter__head { display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 14px; cursor:pointer; }
    .chapter__title { font-weight:800; color:#111; }
    .chapter__desc { color:#666; font-size:12px; }
    .toggle-btn {
      width:28px; height:28px; border-radius:8px; border:1px solid rgba(0,0,0,.12);
      background:#f5f6f8; color:#111; font-weight:900; display:flex; align-items:center; justify-content:center;
    }
    .toggle-btn:hover { background:#eef2f8; }
    .chapter__body { display:none; border-top:1px solid rgba(0,0,0,.06); padding:8px 12px 12px; }

    /* ì ˆ/í•­ëª© ë Œë”ë§ */
    .section { margin:10px 0; }
    .section__title { font-weight:800; margin:8px 0 6px; }
    .items { margin:0; padding-left:18px; }
    .items li { margin:4px 0; }

    /* ë¡œë”©/ì˜¤ë¥˜ */
    .loading { color:#666; font-size:13px; padding:6px 2px; }
    .error { color:#b00020; font-size:13px; padding:6px 2px; white-space:pre-line; }
  </style>
</head>
<body>
  <div class="topbar"><a href="/">â† í¬í„¸ë¡œ ëŒì•„ê°€ê¸°</a></div>
  <div class="wrap">
    <h1>ì†Œì•„ê³¼í•™ ëª©ì°¨</h1>
    <div id="chapters"></div>
  </div>

  <script>
    // ğŸ“ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë“¤ì´ ìˆëŠ” í´ë”
    const BASE = './chapter/';

    // ğŸ”¤ ì‹¤ì œ íŒŒì¼ëª… ëª©ë¡ (í•„ìš”ì‹œ ì¶”ê°€/ìˆ˜ì •)
const CHAPTERS = [
      "1ì¥ ì„œë¡ .md",
      "2á„Œá…¡á†¼ á„‰á…©á„‹á…¡á„‹á…´ á„Œá…µá†«á„ƒá…¡á†«.md",
      "3á„Œá…¡á†¼ á„‰á…¥á†¼á„Œá…¡á†¼á„€á…ª á„‡á…¡á†¯á„ƒá…¡á†¯.md",
      "4á„Œá…¡á†¼ á„‹á…²á„Œá…¥á†«.md",
      "5á„Œá…¡á†¼ á„‰á…©á„‹á…¡á„‹á…´ á„‹á…§á†¼á„‹á…£á†¼.md",
      "6á„Œá…¡á†¼ á„‰á…©á„‹á…¡ á„‹á…£á†¼á„‰á…¢á†¼(å°å…’ é¤Šç”Ÿ).md",
      "7á„Œá…¡á†¼ á„‰á…©á„‹á…¡ á„á…µá„…á…­á„‡á…¥á†¸.md",
      "8á„Œá…¡á†¼ á„‰á…µá†«á„‰á…¢á†¼á„‹á…¡ á„†á…µá†¾ á„á…©á„‰á…¢á†¼á„‡á…§á†¼.md",
      "9á„Œá…¡á†¼ á„€á…¡á†·á„‹á…§á†·á„‡á…§á†¼.md",
      "10á„Œá…¡á†¼ á„’á…©á„’á…³á†¸á„€á…µá„€á…¨á„‹á…´ á„‡á…§á†¼á„Œá…³á†¼ á„†á…µá†¾ á„Œá…µá†¯á„’á…ªá†«.md",
      "11á„Œá…¡á†¼ á„‰á…©á„’á…ªá„€á…µá„€á…¨á„‹á…´ á„‡á…§á†¼á„Œá…³á†¼ á„†á…µá†¾ á„Œá…µá†¯á„’á…ªá†«.md",
      "12á„Œá…¡á†¼ á„‰á…µá†«á„€á…§á†¼á„€á…¨á„‹á…´ á„‡á…§á†¼á„Œá…³á†¼ á„†á…µá†¾ á„Œá…µá†¯á„’á…ªá†«.md",
      "13á„Œá…¡á†¼ á„‰á…©á„‹á…¡á„á…¥á†¼á„‰á…©á„‚á…§á†«á„€á…µ á„Œá…¥á†¼á„‰á…µá†«á„Œá…¡á†¼á„‹á…¢.md",
      "14ì¥ ì‹¬í˜ˆê´€ê³„.md",
      "15á„Œá…¡á†¼ á„€á…¡á†«á„ƒá…¡á†·á„€á…¨á„‹á…´ á„‡á…§á†¼á„Œá…³á†¼ á„†á…µá†¾ á„Œá…µá†¯á„’á…ªá†«.md",
      "16á„Œá…¡á†¼ á„‡á…µá„‚á…­á„‰á…¢á†¼á„‰á…µá†¨á„€á…µá„€á…¨á„‹á…´ á„‡á…§á†¼á„Œá…³á†¼ á„†á…µá†¾ á„Œá…µá†¯á„’á…ªá†«.md",
      "17á„Œá…¡á†¼ á„‹á…¡á†¯á„…á…¦á„…á…³á„€á…µ á„Œá…µá†¯á„’á…ªá†«.md",
      "18á„Œá…¡á†¼ á„†á…§á†«á„‹á…§á†¨á„Œá…µá†¯á„’á…ªá†«.md",
      "19á„Œá…¡á†¼ á„€á…³á†«Â·á„€á…©á†¯á„€á…§á†¨á„€á…¨ á„Œá…µá†¯á„’á…ªá†«.md",
      "20á„Œá…¡á†¼ á„‚á…¢á„‡á…®á†«á„‡á…µá„Œá…µá†¯á„’á…ªá†«.md",
      "21á„Œá…¡á†¼ á„Œá…©á†¼á„‹á…£á†¼.md",
      "22á„Œá…¡á†¼ á„‘á…µá„‡á…®á„Œá…µá†¯á„’á…ªá†«.md",
      "23á„Œá…¡á†¼ á„‹á…¡á†«á„Œá…µá†¯á„’á…ªá†«.md",
      "24á„Œá…¡á†¼ á„Œá…³á†¼á„’á…®.md",
      "25á„Œá…¡á†¼ á„€á…³á†¸á„Œá…³á†¼(á„‰á…©á†«á„‰á…¡á†¼).md",
      "26á„Œá…¡á†¼ á„‰á…©á„‹á…¡á„‹á…´á„…á…­á„‹á…²á†«á„…á…µ.md"
    ];

    const $root = document.getElementById('chapters');

    // ì¥ ì¹´ë“œ ìƒì„±
    CHAPTERS.forEach((fname, idx) => {
      const chapterNo = idx + 1;
      const friendly = fname.replace(/\.md$/,'');
      const el = document.createElement('div');
      el.className = 'chapter';

      el.innerHTML = `
        <div class="chapter__head" data-fname="${fname}">
          <div>
            <div class="chapter__title">ì œ ${chapterNo}ì¥ Â· ${friendly}</div>
            <div class="chapter__desc">+ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëª©ì°¨ í¼ì¹˜ê¸°</div>
          </div>
          <button class="toggle-btn" aria-label="í¼ì¹˜ê¸°" data-fname="${fname}">+</button>
        </div>
        <div class="chapter__body" id="body_${idx}"></div>
      `;
      $root.appendChild(el);
    });

    // ê°„ë‹¨ íŒŒì„œ: # ë¡œ ì‹œì‘í•˜ë©´ 'ì ˆ', "- " ë¡œ ì‹œì‘í•˜ê³  ë’¤ì— "ìˆ«ì. " ìˆìœ¼ë©´ í•­ëª©
    function parseMdToOutline(md) {
      const lines = md.split(/\r?\n/);
      const sections = [];
      let current = null;
      let secIndex = 0;

      for (const raw of lines) {
        const line = raw.trim();
        if (!line) continue;

        // ì„¹ì…˜: "# ì œëª©"
        if (/^#\s+/.test(line)) {
          secIndex += 1;
          const title = line.replace(/^#\s+/, '').replace(/^\d+ì ˆ\s*/,'').trim();
          current = { index: secIndex, title, items: [] };
          sections.push(current);
          continue;
        }

        // í•­ëª©: "- 1. ë‚´ìš©" ë˜ëŠ” "- ë‚´ìš©" (ë²ˆí˜¸ ì—†ìœ¼ë©´ ìë™ ë²ˆí˜¸)
        if (/^-\s+/.test(line) && current) {
          // "- 12. í…ìŠ¤íŠ¸" í¬ë§· ì¡ê¸°
          const m = line.match(/^-\s*(\d+)\.\s*(.+)$/);
          if (m) {
            current.items.push(m[2].trim());
          } else {
            // "- í…ìŠ¤íŠ¸"ë©´ ë²ˆí˜¸ ì—†ì´ ë“¤ì–´ì˜¨ ê±° â†’ ê·¸ëŒ€ë¡œ ë„£ê³  ë‚˜ì¤‘ì— í‘œì‹œ ë•Œ ë²ˆí˜¸ ë¶€ì—¬
            const text = line.replace(/^-+\s*/, '').trim();
            current.items.push(text);
          }
        }
      }
      return sections;
    }

    // ì ˆ/í•­ëª© HTMLë¡œ ê·¸ë¦¬ê¸°
    function renderOutline(sections) {
      if (!sections.length) return '<div class="error">ëª©ì°¨ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';

      let html = '';
      sections.forEach((sec) => {
        html += `<div class="section">
          <div class="section__title">${sec.index}. ${sec.title}</div>`;
        if (sec.items?.length) {
          html += '<ol class="items">';
          sec.items.forEach((t, i) => {
            html += `<li>${i + 1}. ${t}</li>`;
          });
          html += '</ol>';
        }
        html += '</div>';
      });
      return html;
    }

    // í¼ì¹˜ê¸°/ì ‘ê¸° + ë¡œë”©/ìºì‹œ
    const cache = new Map(); // fname -> { sections }
    async function toggleChapter(fname, bodyEl, btnEl) {
      const isOpen = bodyEl.style.display === 'block';
      if (isOpen) {
        bodyEl.style.display = 'none';
        btnEl.textContent = '+';
        btnEl.setAttribute('aria-label','í¼ì¹˜ê¸°');
        return;
      }

      btnEl.textContent = 'â€¦';
      bodyEl.style.display = 'block';
      bodyEl.innerHTML = '<div class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>';

      try {
        let sections;
        if (cache.has(fname)) {
          sections = cache.get(fname);
        } else {
          const url = BASE + encodeURIComponent(fname);
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error('fetch failed ' + res.status);
          const md = await res.text();
          sections = parseMdToOutline(md);
          cache.set(fname, sections);
        }
        bodyEl.innerHTML = renderOutline(sections);
        btnEl.textContent = 'âˆ’';
        btnEl.setAttribute('aria-label','ì ‘ê¸°');
      } catch (e) {
        bodyEl.innerHTML = `<div class="error">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨\n- íŒŒì¼: ${fname}\n- ì—ëŸ¬: ${e.message}</div>`;
        btnEl.textContent = '+';
      }
    }

    // ì´ë²¤íŠ¸ ìœ„ì„
    $root.addEventListener('click', (ev) => {
      const head = ev.target.closest('.chapter__head');
      const btn = ev.target.closest('.toggle-btn');
      if (!head && !btn) return;

      const fname = (btn || head).dataset.fname;
      if (!fname) return;

      // body ì°¾ê¸°
      const card = (btn || head).closest('.chapter');
      const bodyEl = card.querySelector('.chapter__body');
      const btnEl = card.querySelector('.toggle-btn');

      toggleChapter(fname, bodyEl, btnEl);
    });
  </script>
</body>
</html>
